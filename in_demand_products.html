<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Demand Products - Anihan</title>
    <link rel="icon" type="image/png" href="images/pic4.png">
    <link rel="shortcut icon" type="image/png" href="images/pic4.png">
    <link rel="apple-touch-icon" href="images/pic4.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="fixed-layout.css" rel="stylesheet">
    <link href="profile-dropdown.css" rel="stylesheet">
    <link href="in_demand_products.css" rel="stylesheet">
    <style>
        /* Remove conflicting layout styles - let fixed-layout.css handle it */

        /* Table styling improvements */
        .demand-table {
            border-collapse: collapse !important;
        }
        
        .demand-table tbody tr:hover {
            background-color: #f8f9fa !important;
        }
        
        .demand-table tbody td {
            padding: 15px 20px !important;
            border-bottom: 1px solid #e9ecef !important;
            vertical-align: middle !important;
            color: #495057 !important;
        }

        .demand-table thead th {
            font-weight: 600 !important;
            padding: 15px 20px !important;
            background-color: #f8f9fa !important;
            border-bottom: 2px solid #e9ecef !important;
            color: #495057 !important;
            border-top: none !important;
        }
        
        /* Ensure Bootstrap table classes don't override */
        .table thead th {
            background-color: #f8f9fa !important;
        }

        /* Card improvements */
        .demand-card {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
            border: none !important;
            background: white !important;
            border-radius: 10px !important;
            overflow: hidden !important;
        }
        
        .demand-card-header {
            background: #28a745 !important;
            color: white !important;
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            padding: 20px 30px !important;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar navbar-light bg-white border-bottom">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <button class="mobile-menu-toggle me-3 d-md-none" onclick="toggleMobileSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <img src="images/pic4.png" alt="Anihan Logo" class="logo-image me-2">
                    <span class="brand-text">Anihan</span>
                </a>
            </div>
            <div class="navbar-nav">
                <div class="nav-item">
                    <div class="user-avatar" onclick="toggleProfileDropdown()">
                        <img id="userAvatarImage" src="" alt="User Avatar" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; display: none;">
                        <i id="userAvatarIcon" class="fas fa-user"></i>
                        <!-- Profile Dropdown -->
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="profile-dropdown-header">
                                <div class="profile-dropdown-avatar">
                                    <img id="profileAvatarImage" src="" alt="Profile Avatar" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; display: none;">
                                    <i id="profileAvatarIcon" class="fas fa-user"></i>
                                </div>
                                <h6 class="profile-dropdown-name" id="profileUserName">Loading...</h6>
                            </div>
                            <div class="profile-dropdown-details">
                                <div class="profile-detail-item">
                                    <i class="fas fa-envelope"></i>
                                    <span id="profileUserEmail">Loading...</span>
                                </div>
                                <div class="profile-detail-item">
                                    <i class="fas fa-user-tag"></i>
                                    <span id="profileUserRole">Loading...</span>
                                </div>
                                <div class="profile-detail-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <span id="profileUserTitle">System Administrator</span>
                                </div>
                            </div>
                            <div class="profile-dropdown-actions">
                                <button class="btn" onclick="signOut()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Sign out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar bg-white border-end">
                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <a class="nav-link d-flex align-items-center text-start" href="dashboard_super_admin.html">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        Dashboard
                    </a>
                    
                    <a class="nav-link d-flex align-items-center text-start" href="admin_accounts.html">
                        <i class="fas fa-user-shield me-2"></i>
                        Admin Accounts
                    </a>
                    
                    <!-- Account Approval Dropdown -->
                    <div class="nav-dropdown">
                        <button class="nav-link d-flex align-items-center justify-content-between text-start w-100" 
                                type="button" data-bs-toggle="collapse" data-bs-target="#accountApprovalSubmenu" 
                                aria-expanded="false" aria-controls="accountApprovalSubmenu">
                            <span>
                                <i class="fas fa-clipboard-check me-2"></i>
                                Account Approval
                            </span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </button>
                        <div class="collapse" id="accountApprovalSubmenu">
                            <div class="submenu">
                                <a class="nav-link submenu-link d-flex align-items-center text-start" href="for_approval.html">
                                    <i class="fas fa-user-clock me-2"></i>
                                    For Approval
                                </a>
                                <a class="nav-link submenu-link d-flex align-items-center text-start" href="approved_application.html">
                                    <i class="fas fa-user-check me-2"></i>
                                    Approved Applications
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <a class="nav-link d-flex align-items-center text-start" href="inventory_records.html">
                        <i class="fas fa-clipboard-list me-2"></i>
                        Inventory Records
                    </a>
                    
                    <a class="nav-link d-flex align-items-center text-start" href="price_monitoring.html">
                        <i class="fas fa-dollar-sign me-2"></i>
                        Price Monitoring
                    </a>
                    
                    <a class="nav-link active d-flex align-items-center text-start" href="in_demand_products.html">
                        <i class="fas fa-chart-bar me-2"></i>
                        In Demand Products
                    </a>
                    
                    <a class="nav-link d-flex align-items-center text-start" href="sales_per_location.html">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        Sales Per Location
                    </a>
                    
                    <!-- Voucher Dropdown -->
                    <div class="nav-dropdown">
                        <button class="nav-link d-flex align-items-center justify-content-between text-start w-100" 
                                type="button" data-bs-toggle="collapse" data-bs-target="#voucherSubmenu" 
                                aria-expanded="false" aria-controls="voucherSubmenu">
                            <span>
                                <i class="fas fa-ticket-alt me-2"></i>
                                Voucher
                            </span>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </button>
                        <div class="collapse" id="voucherSubmenu">
                            <div class="submenu">
                                <a class="nav-link submenu-link d-flex align-items-center text-start" href="add_voucher.html">
                                    <i class="fas fa-plus me-2"></i>
                                    Add Voucher
                                </a>
                                <a class="nav-link submenu-link d-flex align-items-center text-start" href="voucher_records.html">
                                    <i class="fas fa-list me-2"></i>
                                    Voucher Records
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <a class="nav-link d-flex align-items-center text-start" href="violation.html">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Violation
                    </a>
                </div>
            </div>

            <!-- Mobile Sidebar Overlay -->
            <div class="sidebar-overlay" onclick="closeMobileSidebar()"></div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <div class="demand-card shadow-sm mt-4 mx-auto" style="max-width: 1200px;">
                    <div class="demand-card-header d-flex justify-content-between align-items-center">
                        <span>Most In Demand Products Per Locations</span>
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="form-control search-input" placeholder="Search">
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="demand-table">
                            <thead>
                                <tr>
                                    <th>Store Location</th>
                                    <th>Most Bought Products</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data rows will be populated here -->
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="demand-card-footer">
                        <div class="footer-left">
                            <span id="demandItemsCount" style="color:#495057;font-size:0.95rem;">0 to 0 items of 0</span>
                            <a href="#" style="color:#2563eb;font-size:0.95rem;margin-left:1rem;" onclick="showAllInDemandModal()">View all &gt;</a>
                        </div>
                        <div class="demand-pagination">
                            <button class="btn">&lt;</button>
                            <button class="btn active">1</button>
                            <button class="btn">&gt;</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <!-- Add Supabase Client (required by shared-profile.js) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Add Shared Profile System -->
    <script src="shared-profile.js"></script>
    <script>
        // Use Supabase client from shared-profile.js
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('In Demand Products page loaded');
            // Small delay to ensure shared-profile.js has initialized supabaseClient
            setTimeout(() => {
                loadInDemandProductsData();
            }, 200);
        });

        // Load in demand products data and populate table
        async function loadInDemandProductsData() {
            try {
                console.log('üîÑ Loading in demand products data...');
                
                // Use the global supabaseClient from shared-profile.js
                if (!window.supabaseClient && !supabaseClient) {
                    console.error('‚ùå Supabase client not available');
                    updateDemandTable([]);
                    return;
                }

                const client = window.supabaseClient || supabaseClient;

                // Get product sales data with store information using the same join approach as price monitoring
                const { data: salesData, error } = await client
                    .from('order_items')
                    .select(`
                        quantity,
                        orders!inner(
                            id,
                            total,
                            status
                        ),
                        my_products!inner(
                            id,
                            name,
                            category,
                            price,
                            user_id,
                            users!my_products_user_id_fkey (
                                id,
                                municipality,
                                store-owner!store-owner_user_id_fkey (
                                    store_name
                                )
                            )
                        )
                    `);

                console.log('üìà Sales data query result:', { 
                    dataCount: salesData?.length || 0, 
                    error: error,
                    sampleData: salesData?.slice(0, 3) 
                });

                if (error) {
                    console.error('‚ùå Error fetching sales data:', error);
                    updateDemandTable([]);
                    return;
                }

                if (!salesData || salesData.length === 0) {
                    console.warn('‚ö†Ô∏è No sales data found');
                    updateDemandTable([]);
                    return;
                }

                // Get store owners with their municipalities from users table
                const { data: storeOwners, error: storeError } = await client
                    .from('store-owner')
                    .select(`
                        user_id,
                        store_name,
                        users!inner(
                            id,
                            municipality,
                            address,
                            full_name,
                            email
                        )
                    `);

                console.log('üè™ Store owners query result:', { 
                    dataCount: storeOwners?.length || 0, 
                    error: storeError,
                    sampleData: storeOwners?.slice(0, 3) 
                });

                if (storeError) {
                    console.error('‚ùå Error fetching store owners:', storeError);
                    // Continue with partial data rather than failing completely
                }

                // Create user to municipality mapping from store owners
                const userMunicipalityMap = {};
                if (storeOwners && storeOwners.length > 0) {
                    storeOwners.forEach(owner => {
                        // Use the municipality field from users table as the store location
                        const municipality = owner.users?.municipality || owner.users?.address || 'Unknown Municipality';
                        userMunicipalityMap[owner.user_id] = municipality;
                        console.log(`üó∫Ô∏è Mapped User ${owner.user_id} (${owner.users?.full_name}) to Municipality: ${municipality}`);
                    });
                } else {
                    console.warn('‚ö†Ô∏è No store owners found, will attempt direct user lookup');
                }

                // If we don't have enough municipality mappings, try to get them directly from users table
                if (Object.keys(userMunicipalityMap).length === 0) {
                    console.log('ÔøΩ Attempting direct user lookup for municipalities...');
                    
                    // Get unique user IDs from sales data
                    const userIds = [...new Set(salesData.map(item => item.orders.user_id))];
                    console.log('üë• Found unique user IDs in orders:', userIds);
                    
                    if (userIds.length > 0) {
                        const { data: users, error: usersError } = await client
                            .from('users')
                            .select('id, municipality, address, full_name')
                            .in('id', userIds);
                            
                        if (!usersError && users) {
                            users.forEach(user => {
                                const municipality = user.municipality || user.address || 'Unknown Location';
                                userMunicipalityMap[user.id] = municipality;
                                console.log(`üó∫Ô∏è Direct mapped User ${user.id} (${user.full_name}) to: ${municipality}`);
                            });
                        }
                    }
                }

                console.log('üó∫Ô∏è Final user municipality mapping:', Object.keys(userMunicipalityMap).length, 'users mapped');

                // Process and group the data by store owner's municipality and product
                const processedData = {};
                let processedCount = 0;
                let unknownLocationCount = 0;
                
                salesData.forEach(item => {
                    // Get store information from the joined data (same approach as price monitoring)
                    const product = item.my_products;
                    const user = product?.users;
                    const storeOwner = user?.['store-owner']?.[0];
                    const storeName = storeOwner?.store_name || 'Unknown Store';
                    const municipality = user?.municipality || 'Unknown Location';
                    
                    console.log(`üìç Processing item - Product: ${product?.name}, Municipality: ${municipality}`);
                    
                    const productName = product?.name || 'Unknown Product';
                    const quantity = parseInt(item.quantity) || 0;

                    const key = `${municipality}-${productName}`;
                    
                    if (processedData[key]) {
                        processedData[key].quantity += quantity;
                        processedData[key].orderCount += 1;
                    } else {
                        processedData[key] = {
                            municipality: municipality,
                            productName: productName,
                            category: product?.category || 'Unknown',
                            quantity: quantity,
                            orderCount: 1,
                            storeName: storeName,
                            storeOwnerName: 'Store Owner'
                        };
                    }
                    processedCount++;
                });

                console.log('üìä Processing complete:', { 
                    processedItems: processedCount,
                    uniqueLocationProducts: Object.keys(processedData).length,
                    sampleProcessedData: Object.values(processedData).slice(0, 3)
                });

                // Convert to array and sort by quantity (highest first - most in demand)
                const demandArray = Object.values(processedData)
                    .sort((a, b) => b.quantity - a.quantity);

                console.log('‚úÖ Final demand array:', demandArray.length, 'records');
                console.log('üìã Top 5 most in demand:', demandArray.slice(0, 5));
                
                updateDemandTable(demandArray);

            } catch (error) {
                console.error('üí• Error in loadInDemandProductsData:', error);
                updateDemandTable([]);
            }
        }

        // Update the demand table with data
        function updateDemandTable(demandData) {
            const tableBody = document.querySelector('.demand-table tbody');
            const itemsCount = document.getElementById('demandItemsCount');
            
            if (!tableBody) {
                console.error('Table body not found');
                return;
            }

            if (!demandData || demandData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            No demand data available
                        </td>
                    </tr>
                `;
                if (itemsCount) itemsCount.textContent = '0 to 0 items of 0';
                return;
            }

            // Store all data globally for modal use
            window.allInDemandProducts = demandData;

            // Display first 10 items (simulate pagination)
            const displayData = demandData.slice(0, 10);

            // Generate table rows
            const tableRows = displayData.map((item, index) => `
                <tr>
                    <td>
                        <div class="location-info d-flex align-items-center">
                            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                            <span class="fw-semibold">${item.municipality}</span>
                        </div>
                    </td>
                    <td>
                        <div class="product-info">
                            <div class="product-name fw-semibold">${item.productName}</div>
                            <small class="text-muted">${item.category}</small>
                            ${index === 0 ? '<span class="badge bg-success ms-2"><i class="fas fa-crown"></i> Most Demanded</span>' : ''}
                        </div>
                    </td>
                    <td>
                        <div class="quantity-info">
                            <span class="badge bg-primary fs-6">${item.quantity}</span>
                            <small class="text-muted d-block">${item.orderCount} orders</small>
                        </div>
                    </td>
                </tr>
            `).join('');

            tableBody.innerHTML = tableRows;

            // Update items count
            if (itemsCount) {
                const startItem = 1;
                const endItem = Math.min(10, demandData.length);
                itemsCount.textContent = `${startItem} to ${endItem} items of ${demandData.length}`;
            }

            console.log(`‚úÖ Updated demand table with ${displayData.length} of ${demandData.length} records`);
        }

        // Function to show all in demand products modal
        function showAllInDemandModal() {
            const modal = new bootstrap.Modal(document.getElementById('allInDemandModal'));
            modal.show();
            
            // Load all data into modal
            if (window.allInDemandProducts && window.allInDemandProducts.length > 0) {
                updateAllInDemandTable(window.allInDemandProducts);
            } else {
                updateAllInDemandTable([]);
            }
        }

        // Function to update the all in demand products modal table
        function updateAllInDemandTable(inDemandData) {
            const tableBody = document.getElementById('allInDemandTableBody');
            const countElement = document.getElementById('allInDemandCount');
            
            if (!tableBody) {
                console.error('‚ùå All in demand table body not found');
                return;
            }

            if (!inDemandData || inDemandData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-muted p-4">
                            <i class="fas fa-chart-bar me-2"></i>
                            No in demand products found
                        </td>
                    </tr>
                `;
                if (countElement) countElement.textContent = '0 records found';
                return;
            }

            // Generate all table rows
            tableBody.innerHTML = inDemandData.map((item, index) => {
                return `
                    <tr>
                        <td>
                            <div class="location-info d-flex align-items-center">
                                <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                                <span class="fw-semibold">${escapeHtml(item.municipality || 'N/A')}</span>
                            </div>
                        </td>
                        <td>
                            <div class="product-info">
                                <div class="product-name fw-semibold">${escapeHtml(item.productName || 'N/A')}</div>
                                <small class="text-muted">${escapeHtml(item.category || 'N/A')}</small>
                                ${index === 0 ? '<span class="badge bg-success ms-2"><i class="fas fa-crown"></i> Most Demanded</span>' : ''}
                            </div>
                        </td>
                        <td>
                            <div class="quantity-info">
                                <span class="badge bg-primary fs-6">${escapeHtml(item.quantity || '0')}</span>
                                <small class="text-muted d-block">${escapeHtml(item.orderCount || '0')} orders</small>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            // Update count
            if (countElement) {
                countElement.textContent = `${inDemandData.length} record${inDemandData.length !== 1 ? 's' : ''} found`;
            }

            // Add search functionality
            const searchInput = document.getElementById('inDemandSearchInput');
            if (searchInput) {
                searchInput.oninput = function() {
                    const searchTerm = this.value.toLowerCase();
                    const filteredData = inDemandData.filter(item => 
                        (item.municipality || '').toLowerCase().includes(searchTerm) ||
                        (item.productName || '').toLowerCase().includes(searchTerm) ||
                        (item.category || '').toLowerCase().includes(searchTerm)
                    );
                    
                    if (filteredData.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="3" class="text-center text-muted p-4">
                                    <i class="fas fa-search me-2"></i>
                                    No records found matching "${searchTerm}"
                                </td>
                            </tr>
                        `;
                    } else {
                        tableBody.innerHTML = filteredData.map((item, index) => {
                            return `
                                <tr>
                                    <td>
                                        <div class="location-info d-flex align-items-center">
                                            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                                            <span class="fw-semibold">${escapeHtml(item.municipality || 'N/A')}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="product-info">
                                            <div class="product-name fw-semibold">${escapeHtml(item.productName || 'N/A')}</div>
                                            <small class="text-muted">${escapeHtml(item.category || 'N/A')}</small>
                                            ${index === 0 && filteredData.length === inDemandData.length ? '<span class="badge bg-success ms-2"><i class="fas fa-crown"></i> Most Demanded</span>' : ''}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="quantity-info">
                                            <span class="badge bg-primary fs-6">${escapeHtml(item.quantity || '0')}</span>
                                            <small class="text-muted d-block">${escapeHtml(item.orderCount || '0')} orders</small>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    }
                    
                    if (countElement) {
                        countElement.textContent = `${filteredData.length} record${filteredData.length !== 1 ? 's' : ''} found`;
                    }
                };
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.toString().replace(/[&<>"']/g, m => map[m]);
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const tableRows = document.querySelectorAll('.demand-table tbody tr');
                    
                    tableRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }
        });

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('show');
        }

        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                window.location.href = 'sign_in_form.html';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const userAvatar = document.querySelector('.user-avatar');
            
            if (!userAvatar.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Mobile sidebar functions - CSS only, no duplicate positioning
        function toggleMobileSidebar() {
            const sidebar = document.querySelector('.col-md-3.sidebar') || document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar) {
                // Add navigation content when opening
                if (!sidebar.classList.contains('mobile-open')) {
                    const mobileMenuContent = `
                        <div class="nav flex-column nav-pills">
                            <a class="nav-link" href="dashboard_super_admin.html">Dashboard</a>
                            <a class="nav-link" href="admin_accounts.html">Admin Accounts</a>
                            <a class="nav-link" href="for_approval.html">For Approval</a>
                            <a class="nav-link" href="approved_application.html">Approved Applications</a>
                            <a class="nav-link" href="add_voucher.html">Add Voucher</a>
                            <a class="nav-link" href="voucher_records.html">Voucher Records</a>
                            <a class="nav-link" href="inventory_records.html">Inventory Records</a>
                            <a class="nav-link" href="price_monitoring.html">Price Monitoring</a>
                            <a class="nav-link active" href="in_demand_products.html">In Demand Products</a>
                            <a class="nav-link" href="sales_per_location.html">Sales Per Location</a>
                            <a class="nav-link" href="violation.html">Violation</a>
                        </div>
                    `;
                    sidebar.innerHTML = mobileMenuContent;
                }
                
                // Just toggle the CSS class - let CSS handle all positioning
                sidebar.classList.toggle('mobile-open');
            }
            
            if (overlay) {
                overlay.classList.toggle('active');
            }
            
            document.body.style.overflow = sidebar && sidebar.classList.contains('mobile-open') ? 'hidden' : '';
        }

        function closeMobileSidebar() {
            const sidebar = document.querySelector('.col-md-3.sidebar') || document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar) sidebar.classList.remove('mobile-open');
            if (overlay) overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    </script>

    <!-- All In Demand Products Modal -->
    <div class="modal fade" id="allInDemandModal" tabindex="-1" aria-labelledby="allInDemandModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="allInDemandModalLabel">All In Demand Products</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <input type="text" class="form-control" id="inDemandSearchInput" placeholder="Search by store location, product name...">
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Store Location</th>
                                    <th>Most Bought Products</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody id="allInDemandTableBody">
                                <tr>
                                    <td colspan="3" class="text-center">Loading in demand products...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div>
                            <span id="allInDemandCount">0 records found</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>